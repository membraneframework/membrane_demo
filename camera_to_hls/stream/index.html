<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Live Streaming</title>
</head>

<body>
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <video id="player" controls autoplay class="Player"></video>
    <script>
        var video = document.getElementById('player');

        // var videoSrc = window.location.origin + `/output/index.m3u8`;
        var videoSrc = "/output/index.m3u8";
        if (Hls.isSupported()) {
            var config = {
                autoStartLoad: true,
                startPosition: -1,
                debug: false,
                capLevelOnFPSDrop: false,
                capLevelToPlayerSize: false,
                defaultAudioCodec: undefined,
                initialLiveManifestSize: 1,
                maxBufferLength: 30,
                maxMaxBufferLength: 600,
                backBufferLength: Infinity,
                maxBufferSize: 60 * 1000 * 1000,
                maxBufferHole: 0.5,
                highBufferWatchdogPeriod: 2,
                nudgeOffset: 0.1,
                nudgeMaxRetry: 3,
                maxFragLookUpTolerance: 0.25,
                liveSyncDurationCount: 3,
                liveMaxLatencyDurationCount: Infinity,
                liveDurationInfinity: false,
                enableWorker: true,
                enableSoftwareAES: true,
                manifestLoadingTimeOut: 10000,
                manifestLoadingMaxRetry: 1,
                manifestLoadingRetryDelay: 1000,
                manifestLoadingMaxRetryTimeout: 64000,
                startLevel: undefined,
                levelLoadingTimeOut: 10000,
                levelLoadingMaxRetry: 4,
                levelLoadingRetryDelay: 1000,
                levelLoadingMaxRetryTimeout: 64000,
                fragLoadingTimeOut: 20000,
                fragLoadingMaxRetry: 6,
                fragLoadingRetryDelay: 1000,
                fragLoadingMaxRetryTimeout: 64000,
                startFragPrefetch: false,
                testBandwidth: true,
                progressive: false,
                lowLatencyMode: true,
                fpsDroppedMonitoringPeriod: 500000,
                fpsDroppedMonitoringThreshold: 1,
                appendErrorMaxRetry: 3,
                enableWebVTT: true,
                enableIMSC1: true,
                enableCEA708Captions: true,
                stretchShortVideoTrack: false,
                maxAudioFramesDrift: 1,
                forceKeyFrameOnDiscontinuity: true,
                abrEwmaFastLive: 3.0,
                abrEwmaSlowLive: 9.0,
                abrEwmaFastVoD: 3.0,
                abrEwmaSlowVoD: 9.0,
                abrEwmaDefaultEstimate: 500000,
                abrBandWidthFactor: 0.95,
                abrBandWidthUpFactor: 0.7,
                abrMaxWithRealBitrate: false,
                maxStarvationDelay: 4,
                maxLoadingDelay: 4,
                minAutoBitrate: 0,
                emeEnabled: false,
                widevineLicenseUrl: undefined,
                licenseXhrSetup: undefined,
                drmSystemOptions: {},
                cmcd: undefined,
            };
            const onLevelLoaded = (event, data) => {
                console.log('onLevelLoaded', data);
            };
            var hls = new Hls();
            hls.attachMedia(video);
            hls.on(Hls.Events.LEVEL_LOADED, onLevelLoaded);
            hls.on(Hls.Events.MEDIA_ATTACHED, function () {
                console.log('video and hls.js are now bound together !');
                hls.loadSource(videoSrc);
                hls.on(Hls.Events.MANIFEST_PARSED, function (event, data) {
                    console.log(
                        'manifest loaded, found ' + data.levels.length + ' quality level'
                    );
                });
                hls.on(Hls.Events.ERROR, function (event, data) {
                    if (data.fatal) {
                        switch (data.type) {
                            case Hls.ErrorTypes.NETWORK_ERROR:
                                // try to recover network error
                                console.log('fatal network error encountered, try to recover');
                                hls.startLoad();
                                break;
                            case Hls.ErrorTypes.MEDIA_ERROR:
                                console.log('fatal media error encountered, try to recover');
                                hls.recoverMediaError();
                                break;
                            default:
                                // cannot recover
                                hls.destroy();
                                break;
                        }
                    }
                });
            });
        }

        // else if (video.canPlayType('application/vnd.apple.mpegurl')) {
        //     video.src = videoSrc;
        // }

    </script>

</body>

</html>